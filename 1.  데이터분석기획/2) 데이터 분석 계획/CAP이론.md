# CAP 이론(CAP Theorem)
> 분산 데이터 스토리지 시스템이 **일관성(Consistency)**, **가용성(Availability)**, \*\*파티션 허용오차(Partition Tolerance)\*\*라는 세 가지 보장 중  
> 동시에 **최대 두 가지만 만족**시킬 수 있다는 정리입니다.

이 이론은 분산 시스템을 설계할 때 어떤 특성을 우선시하고 어떤 것을 희생할지 결정하는 근본적인 지침을 제공합니다.

-----

### \#\# CAP의 세 가지 요소

1.  **🔗 Consistency (일관성)**

      * 모든 노드가 **항상 동일한 최신 데이터**를 보여주는 것을 보장합니다.
      * **동작**: 하나의 노드에서 데이터가 변경(Write)되면, 이 변경 사항이 다른 모든 노드에 완전히 복제될 때까지 다른 모든 읽기(Read) 요청은 차단되거나, 가장 최신 데이터를 반환해야 합니다.
      * **비유**: 은행 계좌와 같습니다. A 지점에서 100만 원을 출금하면, B 지점에서도 즉시 잔액이 100만 원 줄어든 것으로 보여야 합니다. 데이터가 일치하지 않는 순간은 절대 허용되지 않습니다.

2.  **✅ Availability (가용성)**

      * 모든 요청에 대해 시스템이 **항상 정상적으로 응답**하는 것을 보장합니다. (오류를 반환하더라도 응답은 해야 함)
      * **동작**: 일부 노드에 장애가 발생하더라도, 살아있는 다른 노드들이 요청을 계속 처리합니다. 이때 반환되는 데이터가 최신 버전이 아닐 수는 있습니다.
      * **비유**: 소셜 미디어의 '좋아요' 버튼과 같습니다. 네트워크가 잠시 불안정해도 '좋아요'를 누를 수 있고, 이 정보는 나중에 동기화됩니다. 시스템이 멈추지 않고 항상 작동하는 것이 중요합니다.

3.  **🌐 Partition Tolerance (파티션 허용오차)**

      * 노드 간 통신에 **네트워크 장애(파티션)가 발생**해도 시스템이 **계속 동작**하는 것을 보장합니다.
      * **동작**: 분산 시스템은 여러 서버로 구성되므로, 서버 간의 통신이 끊어지는 일은 언제든 발생할 수 있습니다. 이 상황에서도 시스템 전체가 멈추지 않아야 한다는 의미입니다.
      * **현실**: 현대의 분산 시스템에서 네트워크 장애는 피할 수 없는 현실이므로, **P는 사실상 포기할 수 없는 기본 전제**입니다.

-----

### \#\# Trade-off: 왜 세 가지 모두 가질 수 없는가?

네트워크 장애(P)는 언제든 발생할 수 있으므로, 시스템 설계자는 **네트워크 파티션이 발생했을 때 일관성(C)과 가용성(A) 중 무엇을 선택할지** 결정해야 합니다.

**네트워크 파티션 발생 상황**

  * **CP 선택 (Consistency \> Availability)**: 네트워크가 분리되면, 데이터의 일관성을 깨뜨릴 위험이 있는 노드는 **요청 처리를 중단**하고 오류를 반환합니다. 데이터의 정합성을 최우선으로 하지만, 일시적으로 서비스가 멈출 수 있습니다(가용성 희생).
  * **AP 선택 (Availability \> Consistency)**: 네트워크가 분리되어도, 각 노드는 **자신이 가진 데이터로 요청을 계속 처리**합니다. 서비스는 멈추지 않지만, 분리된 노드 간 데이터가 일시적으로 불일치할 수 있습니다(일관성 희생). 데이터는 나중에 네트워크가 복구되면 동기화됩니다(이를 '최종적 일관성'이라 부름).

### \#\# 한눈에 보는 비교

| 구분 | CP 시스템 (Consistency + Partition Tolerance) | AP 시스템 (Availability + Partition Tolerance) |
| :--- | :--- | :--- |
| **우선순위**| 데이터의 **정확성과 일관성** | **중단 없는 서비스**와 빠른 응답 |
| **동작 방식**| 데이터 변경 시 모든 노드에 동기화될 때까지 대기 | 일단 요청을 처리하고, 나중에 데이터를 동기화 |
| **단점** | 네트워크 장애 시 일부 노드 서비스 중단 가능 | 최신 데이터가 아닐 수 있음 |
| **사용 예시**| **RDBMS** (PostgreSQL, MySQL 클러스터), **HBase** | **대부분의 NoSQL** (Cassandra, DynamoDB, CouchDB) |
