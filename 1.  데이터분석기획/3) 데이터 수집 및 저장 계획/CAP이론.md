# CAP 이론 
> CAP 이론에서 세 가지 요소를 동시에 만족시킬 수 없는 이유는
> **네트워크 분할(Partition Tolerance)이 발생하는 순간, 데이터 일관성(Consistency)과 가용성(Availability)이 서로 양립할 수 없는 관계**가 되기 때문입니다.

간단한 시나리오를 통해 쉽게 이해해 보겠습니다.

---

### ## CAP 이론의 세 가지 요소 💡

먼저 세 가지 요소의 의미를 간단히 짚어보겠습니다.

* **C - 일관성 (Consistency)**: 모든 노드는 언제나 **동일한 데이터**를 가지고 있어야 합니다. 사용자가 어떤 노드에 접속하든 항상 최신 데이터를 읽을 수 있음을 보장합니다.
* **A - 가용성 (Availability)**: 모든 요청에 대해 시스템은 **항상 응답**해야 합니다. 일부 노드에 장애가 발생하더라도 서비스는 중단되지 않고 정상적으로 응답해야 합니다. (데이터가 최신이 아닐 수는 있습니다.)
* **P - 분산 허용 (Partition Tolerance)**: 노드 간에 통신이 끊어지는 **네트워크 분할** 상황이 발생하더라도 시스템은 계속 동작해야 합니다. 현대의 분산 시스템에서는 네트워크 장애가 언제든 발생할 수 있으므로, **'P'는 선택이 아닌 필수**로 여겨집니다.

---

### ## 왜 세 가지를 모두 만족할 수 없을까? (The Conflict)

문제는 **네트워크 분할(P)이 발생했을 때** 발생합니다.

여기 똑같은 데이터를 가진 **노드1**과 **노드2**로 구성된 간단한 분산 시스템이 있다고 가정해 봅시다.

1.  **정상 상태**: 노드1과 노드2는 서로 통신하며 데이터를 완벽하게 동기화하고 있습니다. (`값 = 10`)

2.  **네트워크 분할 발생 (P)**: 갑자기 네트워크에 문제가 생겨 노드1과 노드2의 통신이 끊어졌습니다. 이제 시스템은 **분산 허용(P)을 만족**하며 동작해야 합니다.

3.  **데이터 변경 요청**: 이때, 한 사용자가 **노드1**에 접속하여 데이터를 `값 = 20`으로 변경해달라고 요청합니다.

이제 시스템은 **딜레마**에 빠집니다. **일관성(C)과 가용성(A) 중 하나를 선택해야 합니다.**

#### **선택 1: 일관성(C)을 선택한다면? (CP 시스템)**

* **노드1**은 `값 = 20`으로 데이터를 변경했습니다.
* **일관성**을 지키기 위해, **노드1**은 반드시 **노드2**에도 이 변경 사항을 알려 데이터를 동기화해야 합니다.
* 하지만 네트워크 분할 때문에 **노드2**와 통신할 수 없습니다.
* 이때 다른 사용자가 **노드2**에 데이터를 요청하면, **노드2**는 최신 데이터(`값 = 20`)를 줄 수 없습니다. 일관성을 깨뜨리지 않기 위해 **노드2**는 **응답을 포기하거나 에러를 반환**해야 합니다.
* **결과**: 데이터 **일관성(C)은 지켰지만**, 노드2가 응답하지 못했으므로 **가용성(A)은 포기**하게 됩니다.

#### **선택 2: 가용성(A)을 선택한다면? (AP 시스템)**

* **노드1**은 `값 = 20`으로 데이터를 변경하고, 즉시 "성공"이라고 응답합니다.
* **가용성**을 지키기 위해, 다른 사용자가 **노드2**에 데이터를 요청했을 때 **노드2**는 무조건 응답해야 합니다.
* **노드2**는 노드1의 변경 사실을 모르므로, 자신이 가진 옛날 데이터인 `값 = 10`을 응답합니다.
* **결과**: 모든 요청에 응답했으므로 **가용성(A)은 지켰지만**, 노드1과 노드2의 데이터가 달라져 **일관성(C)은 포기**하게 됩니다.

이처럼 네트워크 분할(P)이라는 현실적인 제약 조건 하에서는, 일관성(C)과 가용성(A)이 트레이드오프 관계가 되므로 **둘 중 하나만 선택**할 수밖에 없습니다.   
이것이 CAP 이론의 핵심입니다.

---

### ## 현실 세계의 선택: CP와 AP 시스템

* **CP (Consistency + Partition Tolerance)**: 데이터의 정확성이 무엇보다 중요한 시스템에서 사용됩니다. (예: 은행 계좌, 결제 시스템, RDBMS)
* **AP (Availability + Partition Tolerance)**: 일시적인 데이터 불일치를 감수하더라도 서비스가 절대 중단되면 안 되는 경우에 사용됩니다. (예: 소셜 미디어 피드, 일부 NoSQL 데이터베이스 مثل Cassandra, DynamoDB)
