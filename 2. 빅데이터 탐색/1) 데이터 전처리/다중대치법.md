# 다중 대치법(Multiple Imputation)의 3단계 구조

## 🎯 다중 대치법 개요

다중 대치법은 **Rubin(1987)**에 의해 개발된 결측값 처리 방법으로, 결측값을 여러 번 대치하여 **불확실성**을 정량화하는 통계적 방법입니다.

---

## 📋 1단계: 대치 단계 (Imputation Stage)

### 🔍 목적
- 결측값을 **여러 개의 합리적인 값**으로 대치
- 각 대치는 결측값에 대한 **하나의 가능한 시나리오**를 나타냄

### ⚙️ 과정
1. **결측값 모델링**
   - 관측된 데이터를 바탕으로 결측값 예측 모델 구축
   - 각 변수를 다른 변수들의 함수로 모델링

2. **반복적 대치 (예: MICE)**
   ```
   반복 1: X1 | X2, X3, X4... → 대치 데이터셋 1
   반복 2: X1 | X2, X3, X4... → 대치 데이터셋 2
   반복 3: X1 | X2, X3, X4... → 대치 데이터셋 3
   ...
   반복 M: X1 | X2, X3, X4... → 대치 데이터셋 M
   ```

3. **불확실성 반영**
   - 각 대치값은 예측값 + 무작위 오차
   - 결측값에 대한 **불확실성을 보존**

### 📊 결과물
- **M개의 완전한 데이터셋** (보통 M = 3~10)
- 각 데이터셋은 서로 다른 대치값을 가짐

---

## 📈 2단계: 분석 단계 (Analysis Stage)

### 🔍 목적
- 각 대치 데이터셋에 대해 **동일한 통계 분석** 수행
- 관심 있는 통계량(회귀계수, 평균, 분산 등) 계산

### ⚙️ 과정
1. **개별 분석**
   ```
   데이터셋 1 → 분석 → 결과 1 (θ̂₁, SE₁²)
   데이터셋 2 → 분석 → 결과 2 (θ̂₂, SE₂²)
   데이터셋 3 → 분석 → 결과 3 (θ̂₃, SE₃²)
   ...
   데이터셋 M → 분석 → 결과 M (θ̂ₘ, SEₘ²)
   ```

2. **동일한 분석 방법 적용**
   - 회귀분석, t-검정, ANOVA 등
   - 각 데이터셋에서 동일한 모델 적합

### 📊 결과물
- **M개의 분석 결과**
- 각 결과: 추정값(θ̂ᵢ)과 표준오차(SEᵢ)

---

## 🔗 3단계: 결합 단계 (Pooling Stage)

### 🔍 목적
- M개의 분석 결과를 **하나의 최종 결과**로 결합
- **Rubin's Rules** 적용하여 불확실성 정량화

### ⚙️ Rubin's Rules

#### 1️⃣ **최종 추정값 (Pooled Estimate)**
```
θ̄ = (1/M) × Σθ̂ᵢ
```
- M개 추정값의 단순 평균

#### 2️⃣ **분산 분해 (Variance Decomposition)**

**Within-imputation variance (평균 분산)**:
```
W̄ = (1/M) × ΣSEᵢ²
```
- 각 대치 데이터셋 내의 평균 분산

**Between-imputation variance (대치간 분산)**:
```
B = (1/(M-1)) × Σ(θ̂ᵢ - θ̄)²
```
- 대치 결과들 간의 변동성

#### 3️⃣ **총 분산 (Total Variance)**
```
T = W̄ + (1 + 1/M) × B
```
- 분석 불확실성 + 대치 불확실성

#### 4️⃣ **자유도 (Degrees of Freedom)**
```
ν = (M-1) × [1 + W̄/((1+1/M)×B)]²
```

### 📊 최종 결과
- **점추정값**: θ̄
- **표준오차**: √T  
- **신뢰구간**: θ̄ ± t_(ν,α/2) × √T
- **검정통계량**: t = θ̄/√T (자유도 ν인 t분포)

---

## 🎯 다중 대치법의 핵심 장점

### 1️⃣ **불확실성 정량화**
- 결측값으로 인한 불확실성을 **명시적으로 측정**
- 단순 대치법보다 **현실적인 표준오차** 제공

### 2️⃣ **편향 감소**
- 결측값 패턴을 적절히 모델링하면 **편향 최소화**
- MAR(Missing At Random) 가정 하에서 **일치추정량**

### 3️⃣ **유연성**
- 다양한 **통계 분석 방법**에 적용 가능
- 복잡한 **결측값 패턴** 처리 가능

### 4️⃣ **효율성**
- 적은 수의 대치(M=3~5)로도 **높은 효율성** 달성
- 계산 비용 대비 **우수한 성능**

---

## 📊 실제 적용 예시

### 상황: 학생 성적 데이터 분석

```
원본 데이터:
학생    영어    수학    과학
철수     85     NA      90
영희     78     88      NA  
민수     92     90      95
```

#### 1단계: 대치
```
대치셋 1:  철수(85, 84.2, 90), 영희(78, 88, 89.1), 민수(92, 90, 95)
대치셋 2:  철수(85, 86.1, 90), 영희(78, 88, 87.8), 민수(92, 90, 95)  
대치셋 3:  철수(85, 85.5, 90), 영희(78, 88, 88.9), 민수(92, 90, 95)
```

#### 2단계: 분석 (영어-수학 상관계수)
```
대치셋 1 → r₁ = 0.45, SE₁ = 0.12
대치셋 2 → r₂ = 0.52, SE₂ = 0.11  
대치셋 3 → r₃ = 0.48, SE₃ = 0.13
```

#### 3단계: 결합
```
최종 상관계수: r̄ = (0.45 + 0.52 + 0.48)/3 = 0.48
Within variance: W̄ = (0.12² + 0.11² + 0.13²)/3 = 0.0147
Between variance: B = [(0.45-0.48)² + (0.52-0.48)² + (0.48-0.48)²]/2 = 0.0013
Total variance: T = 0.0147 + (1+1/3) × 0.0013 = 0.0164
최종 표준오차: SE = √0.0164 = 0.128
```

---

## ⚠️ 주의사항

### 1️⃣ **결측값 메커니즘**
- **MAR 가정** 필요 (Missing At Random)
- MNAR인 경우 **편향 가능성** 존재

### 2️⃣ **대치 모델의 적합성**
- 잘못된 대치 모델은 **편향된 결과** 초래
- **모델 진단**과 **타당성 검증** 필수

### 3️⃣ **계산 복잡성**
- 대량 데이터에서 **계산 시간** 증가
- **수렴성 확인** 필요

### 4️⃣ **대치 수(M) 선택**
- 너무 적으면 **불확실성 과소추정**
- 너무 많으면 **계산 비용** 증가
- **일반적으로 M=5~10 권장**

---

## 🚀 결론

다중 대치법은 **3단계 체계적 접근**을 통해 결측값 문제를 해결하는 강력한 방법입니다:

1. **대치**: 불확실성을 반영한 여러 시나리오 생성
2. **분석**: 각 시나리오에 대한 일관된 분석 수행  
3. **결합**: Rubin's Rules로 최종 결과 도출

이 방법은 단순한 결측값 '채우기'가 아닌, **불확실성까지 고려한 과학적 추론**을 가능하게 합니다.
